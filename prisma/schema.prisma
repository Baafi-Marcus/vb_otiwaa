generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://neondb_owner:npg_6TkJ3hExvyez@ep-damp-wildflower-ah9zhgrw-pooler.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require"
}

model Merchant {
  id                    String     @id @default(uuid())
  name                  String
  whatsappPhoneNumberId String     @unique
  password              String?    // Added for authentication
  systemPrompt          String?
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  baseDeliveryFee       Decimal    @default(0) @db.Decimal(10, 2)
  category              String?
  clientVision          String?
  isClosed              Boolean    @default(false)
  location              String?
  menuImageUrl          String?
  operatingHours        String?
  paymentMethods        String?
  twilioPhoneNumber     String?
  deliveryZones         DeliveryZone[]
  customers             Customer[]
  orders                Order[]
  catalog               Product[]
}

model Admin {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DeliveryZone {
  id         String   @id @default(uuid())
  name       String
  price      Decimal  @db.Decimal(10, 2)
  merchantId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  merchant   Merchant @relation(fields: [merchantId], references: [id])
}

model Product {
  id          String      @id @default(uuid())
  name        String
  description String?
  price       Decimal     @db.Decimal(10, 2)
  category    String?
  imageUrl    String?
  merchantId  String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orderItems  OrderItem[]
  merchant    Merchant    @relation(fields: [merchantId], references: [id])
}

model Order {
  id              String      @id @default(uuid())
  shortId         String?     @unique
  customerName    String
  customerPhone   String
  merchantId      String
  totalAmount     Decimal     @db.Decimal(10, 2)
  status          String      @default("PENDING")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  deliveryFee     Decimal     @default(0) @db.Decimal(10, 2)
  fulfillmentMode String?
  customerId      String?
  location        String?
  customer        Customer    @relation(fields: [customerPhone], references: [phoneNumber])
  merchant        Merchant    @relation(fields: [merchantId], references: [id])
  items           OrderItem[]
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model Customer {
  id          String   @id @default(uuid())
  phoneNumber String   @unique
  name        String?
  lastSeen    DateTime @default(now())
  merchantId  String
  botPaused   Boolean  @default(false)
  merchant    Merchant @relation(fields: [merchantId], references: [id])
  orders      Order[]
}

model StoredImage {
  id        String   @id @default(uuid())
  data      Bytes
  mimeType  String
  filename  String
  createdAt DateTime @default(now())
}

model ConversationalContext {
  id          String   @id @default(uuid())
  phoneNumber String   @unique
  context     Json
  updatedAt   DateTime @updatedAt
}

model SystemConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

model WebhookLog {
  id        String   @id @default(uuid())
  provider  String   @default("TWILIO")
  payload   Json
  createdAt DateTime @default(now())
}
